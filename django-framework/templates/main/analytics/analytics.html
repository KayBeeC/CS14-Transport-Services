{% extends "main/analytics/base.html" %}
{% load static %}
{% block title %}

{% endblock %}


{% block contend %}

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-brush@3"></script>
<link rel="stylesheet" href='{% static 'CSS/analytics/analytics.css' %}'>
<div id="div_travel_frequency">
    <h2>
        Travel Frequency
    </h2>
    <p id="tab_travel_frequency">
        <svg width="900" height="750"></svg>
    </p>

</div>
<div id="div_destination">
    <h2>
        Destination
    </h2>

    <p id="tab_destination">
        <svg width="900" height="750"></svg>
    </p>

</div>
<div>
    <h2>
        Vehicle Types
    </h2>
    <p id="vehicle_types">
         <svg width="900" height="750"></svg>
    </p>
</div>
<div>
    <h2>
        Average Fuel Usage
    </h2>
    <p id="average_fuel_usage">
         <svg width="900" height="750"></svg>
    </p>
</div>
<div>
    <h2>
        Average Miles Traveled
    </h2>
    <p id="average_miles_traveled">
         <svg width="900" height="750"></svg>
    </p>
</div>
    
{% endblock %}
{% block extra_js %}
    <script>


//json data
    const formatDate = d3.timeParse("%Y-%m-%d");
    var received_data  = {{ data|safe }};
    var obj = JSON.parse(received_data);
    console.log(obj[1]);

    obj.forEach(
        function (d){
            d.fields.start_date=formatDate(d.fields.start_date);
        }
    )
    console.log(obj[1])



    // d3 drawing

    //frequency data preparation, can see console.log information to check frequency correct or not


    var tally = {};
    obj.forEach(function (d){
        tally[d.fields.start_date]=(tally[d.fields.start_date]||0) + 1;
    })

    var data = [];
    for (var date in tally) {
    if (tally.hasOwnProperty(date)) {
        data.push({
            date: new Date(date),
            frequency: tally[date]
        });
    }}
    console.log(data)


    </script>
    <script src="{% static 'js/travel-frequency-graph.js' %}"></script>
{% endblock %}