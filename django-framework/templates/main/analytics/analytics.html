{% extends "main/analytics/base.html" %}
{% load static %}
{% block title %}

{% endblock %}


{% block contend %}

<script src="https://d3js.org/d3.v7.min.js"></script>
<link rel="stylesheet" href='{% static 'CSS/analytics/analytics.css' %}'>
<div id="div_travel_frequency">
    <h2>
        Travel Frequency
    </h2>
    <p id="tab_travel_frequency">
    <svg width="600" height="500"></svg>
    </p>

</div>
<div id="div_destination">
    <h2>
        Destination
    </h2>

    <p>
    </p>

</div>
<div>
    <h2>
        Vehicle Types
    </h2>
    <p></p>
</div>
<div>
    <h2>
        Average Fuel Usage
    </h2>
    <p></p>
</div>
<div>
    <h2>
        Average Miles Traveled
    </h2>
    <p></p>
</div>
    
{% endblock %}
{% block extra_js %}
    <script>


//json data
    var received_data  = {{ data|safe }};
    var obj = JSON.parse(received_data);
    console.log(obj[1]);

// d3 drawing
    var svg = d3.select("svg"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - margin;


    var xScale = d3.scaleBand().range ([0, width]).padding(0.6),
        yScale = d3.scaleLinear().range ([height, 0]);

    var g = svg.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");
    xScale.domain(obj.map(function(d) { return d.fields.driver; }));
    yScale.domain([0, d3.max(obj, function(d) { return d.fields.mileage_start; })]);

        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale));

        g.append("g")
         .call(d3.axisLeft(yScale).tickFormat(function(d){
             return  d+"L";
         }).ticks(10))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("mileageStart");

        g.selectAll(".bar")
         .data(obj)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return xScale(d.fields.driver); })
         .attr("y", function(d) { return yScale(d.fields.mileage_start); })
         .attr("width", xScale.bandwidth())
         .attr("height", function(d) { return height - yScale(d.fields.mileage_start); });







    </script>
{% endblock %}